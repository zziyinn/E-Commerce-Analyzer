const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Jd6TsP0i.js","assets/index-DTWxAghn.css"])))=>i.map(i=>d[i]);
import{_ as ie,c as u,a as s,t as l,m as P,v as ce,p as N,q as R,F as k,r as T,e as V,h as de,g as W,f as ue,w as he,s as z,n as O,b as Q,x as me,u as ge,i as y,y as pe,j as p,P as A,z as K,k as fe,A as ve,l as d}from"./index-Jd6TsP0i.js";import{P as be}from"./ProductCard-B0q4MI7o.js";import{D as ye}from"./DataTable-Ctq5dUfC.js";const j=o=>o==="low"?30:o==="medium"?60:100,_e=o=>{if(!o)return[null,null];if(o==="200+")return[200,null];const[r,h]=o.split("-").map(Number);return[Number.isFinite(r)?r:null,Number.isFinite(h)?h:null]},M=o=>typeof o.sales=="number"?o.sales:Math.round(o.marginRate*25+150),L=o=>{if(typeof o.rating=="number")return o.rating;const r=4.8-o.competitionScore/100*1.5;return Number(Math.max(3,Math.min(5,r)).toFixed(1))},we={name:"Search",components:{ProductCard:be,DataTable:ye},setup(){const o=fe(),{t:r}=me(),h=ge(),t=[A.AMAZON,A.SHOPEE,A.LAZADA,A.EBAY,A.ALIEXPRESS],v=y(""),m=pe({platform:"",category:"",priceRange:"",competition:""}),_=y("relevance"),b=y("desc"),a=y("grid"),g=y(1),w=y(12),q=p(()=>h.loading),C=y(!1),Z=p(()=>[{key:"image",label:"",sortable:!1,className:"image-cell"},{key:"title",label:r("search.table.name"),sortable:!0},{key:"platform",label:r("search.table.platform"),sortable:!0},{key:"formattedPrice",label:r("search.table.price"),sortable:!0},{key:"sales",label:r("search.table.sales"),sortable:!0},{key:"rating",label:r("search.table.rating"),sortable:!0},{key:"competition",label:r("search.table.competition"),sortable:!0}]),H=p(()=>{const e=Array.from(new Set(h.products.map(n=>n.platform)));return Array.from(new Set([...t,...e]))}),E=e=>{const n=`settings.platforms.${e}`,i=r(n);return i===n?e:i},X=p(()=>{const e=new Set(h.products.map(n=>n.category));return Array.from(e)}),D=p(()=>{const[e,n]=_e(m.priceRange);let i=[];return v.value.trim()?i=h.searchProducts(v.value,{platform:m.platform||"all",category:m.category||"all",minMargin:0,maxCompetition:j(m.competition)}):i=h.products.filter(c=>!(m.platform&&c.platform!==m.platform||m.category&&c.category!==m.category||c.competitionScore>j(m.competition))),i.filter(c=>!(e!==null&&c.price<e||n!==null&&c.price>n))}),U=p(()=>{const e=[...D.value],n=b.value==="asc"?1:-1;switch(_.value){case"sales":return e.sort((i,c)=>(M(i)-M(c))*n);case"price":return e.sort((i,c)=>(i.price-c.price)*n);case"rating":return e.sort((i,c)=>(L(i)-L(c))*n);case"competition":return e.sort((i,c)=>(i.competitionScore-c.competitionScore)*n);default:return e}}),F=p(()=>Math.max(1,Math.ceil(U.value.length/w.value))),Y=p(()=>{const e=(g.value-1)*w.value;return U.value.slice(e,e+w.value)}),G=p(()=>U.value.map(e=>({id:e.id,image:e.imageUrl,imageUrl:e.imageUrl,productUrl:e.productUrl||e.url,title:e.title,platform:E(e.platform),formattedPrice:e.formattedPrice,sales:M(e),rating:L(e),competition:e.competitionLevel}))),J=(e,n)=>{e.stopPropagation();const i=n.productUrl||n.url;i&&window.open(i,"_blank","noopener,noreferrer")},$=p(()=>{const e=(g.value-1)*w.value;return G.value.slice(e,e+w.value)}),x=p(()=>{const e=[],n=F.value,i=g.value,c=2,B=Math.max(1,i-c),S=Math.min(n,i+c);for(let f=B;f<=S;f+=1)e.push(f);return e}),I=async()=>{if(!(!v.value||v.value.trim()==="")){g.value=1,C.value=!0;try{if((await(await ve(async()=>{const{productService:i}=await import("./index-Jd6TsP0i.js").then(c=>c.L);return{productService:i}},__vite__mapDeps([0,1]))).productService.scrapeProducts(v.value.trim(),{fetchDetails:!1,maxProducts:15})).success){await new Promise(i=>setTimeout(i,1500));try{await h.refresh(),console.log(`[Search] Refreshed, now have ${h.products.length} products in store`),console.log(`[Search] Filtered products: ${D.value.length}`),D.value.length===0&&h.products.length>0&&console.log("[Search] No filtered results, showing all products")}catch(i){console.error("[Search] Refresh failed, trying initialize:",i),h.isInitialized=!1,await h.initialize()}}}catch(e){console.error("Search/Scraping failed:",e)}finally{C.value=!1}}},ee=()=>{m.platform="",m.category="",m.priceRange="",m.competition="",I()},te=()=>{a.value=a.value==="grid"?"table":"grid"},oe=e=>{e>=1&&e<=F.value&&(g.value=e)},ae=e=>{const n=typeof e=="string"?e:e==null?void 0:e.id;n&&o.push(`/products/${n}`)},se=e=>{try{h.toggleWatch(e)}catch(n){console.error("Failed to toggle watchlist:",n)}},re=e=>{try{h.addToCompare(e)}catch(n){console.error("Failed to add product to compare:",n)}},le=({key:e,order:n})=>{_.value=e,b.value=n==="asc"?"asc":"desc",g.value=1},ne=async()=>{C.value=!0;try{const n=(()=>{if(typeof window<"u"&&window.location){const f=window.location.hostname;if(!(f==="localhost"||f==="127.0.0.1"||f.startsWith("192.168.")||f.startsWith("10.")||f.startsWith("172.16.")))return""}return"http://localhost:8000"})(),i=`${n}/api/seed/sample-products`;console.log(`[Search] API_BASE_URL: "${n}", Full URL: ${i}`),console.log(`[Search] Loading sample data from: ${i}`);const c=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin"});if(!c.ok){const S=await c.text();throw console.error(`[Search] Failed to load sample data: ${c.status}`,S),new Error(`Failed to load sample data: ${c.status}`)}const B=await c.json();console.log("[Search] Sample data loaded:",B),await new Promise(S=>setTimeout(S,1e3)),await h.refresh(),console.log(`[Search] Refreshed, now have ${h.products.length} products`)}catch(e){console.error("[Search] Failed to load sample data:",e),alert("åŠ è½½ç¤ºä¾‹æ•°æ®å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}finally{C.value=!1}};return K([v,()=>m.platform,()=>m.category,()=>m.priceRange,()=>m.competition],()=>{g.value=1}),K(_,(e,n)=>{e==="relevance"?b.value="desc":(e==="price"||e==="competition")&&e!==n?b.value="asc":e!==n&&(b.value="desc")}),{t:r,loading:q,scraping:C,searchQuery:v,filters:m,sortBy:_,sortOrder:b,viewMode:a,currentPage:g,pageSize:w,tableColumns:Z,platforms:H,categories:X,filteredProducts:D,paginatedProducts:Y,paginatedTableRows:$,totalPages:F,visiblePages:x,handleSearch:I,clearFilters:ee,toggleView:te,goToPage:oe,viewProductDetails:ae,toggleWatch:se,addToCompare:re,handleSort:le,handleImageClick:J,translatePlatform:E,loadSampleData:ne,isWatched:h.isWatched,isInCompare:h.isInCompare}}},Se={class:"search-page"},Pe={class:"page-header"},ke={class:"page-title"},Ce={class:"page-subtitle"},Re={class:"search-section"},Ae={class:"search-form"},De={class:"search-input-group"},Te=["placeholder"],Ue=["disabled"],Fe={class:"filters"},Be={class:"filter-group"},Ve={class:"filter-label"},Me={value:""},Le=["value"],Ee={class:"filter-group"},Ie={class:"filter-label"},Ne={value:""},We=["value"],ze={class:"filter-group"},Oe={class:"filter-label"},Qe={value:""},Ke={value:"0-50"},je={value:"50-100"},qe={value:"100-200"},Ze={value:"200+"},He={class:"filter-group"},Xe={class:"filter-label"},Ye={value:""},Ge={value:"low"},Je={value:"medium"},$e={value:"high"},xe={class:"results-section"},et={class:"results-header"},tt={class:"results-info"},ot={class:"results-count"},at={key:0,class:"search-term"},st={class:"results-actions"},rt={value:"relevance"},lt={value:"sales"},nt={value:"price"},it={value:"rating"},ct={value:"competition"},dt={key:0,class:"results-content"},ut={key:0,class:"products-grid"},ht={key:1,class:"products-table"},mt=["src","alt","onClick","onKeyup","aria-label"],gt={key:1,class:"table-image-placeholder"},pt={key:2,class:"pagination"},ft=["disabled"],vt={class:"page-numbers"},bt=["onClick"],yt=["disabled"],_t={key:1,class:"empty-results"},wt={class:"empty-title"},St={class:"empty-text"},Pt={class:"empty-actions"};function kt(o,r,h,t,v,m){const _=W("ProductCard"),b=W("DataTable");return d(),u("div",Se,[s("div",Pe,[s("h1",ke,l(o.$t("search.title")),1),s("p",Ce,l(o.$t("search.subtitle")),1)]),s("div",Re,[s("div",Ae,[s("div",De,[P(s("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>t.searchQuery=a),type:"text",class:"form-input search-input",placeholder:o.$t("search.placeholder"),onKeyup:r[1]||(r[1]=N((...a)=>t.handleSearch&&t.handleSearch(...a),["enter"]))},null,40,Te),[[ce,t.searchQuery]]),s("button",{class:"btn btn-primary search-btn",disabled:t.loading||t.scraping,onClick:r[2]||(r[2]=(...a)=>t.handleSearch&&t.handleSearch(...a))},l(t.loading||t.scraping?o.$t("search.searching"):o.$t("search.searchButton")),9,Ue)]),s("div",Fe,[s("div",Be,[s("label",Ve,l(o.$t("search.platform")),1),P(s("select",{"onUpdate:modelValue":r[3]||(r[3]=a=>t.filters.platform=a),class:"form-select"},[s("option",Me,l(o.$t("search.allPlatforms")),1),(d(!0),u(k,null,T(t.platforms,a=>(d(),u("option",{key:a,value:a},l(t.translatePlatform(a)),9,Le))),128))],512),[[R,t.filters.platform]])]),s("div",Ee,[s("label",Ie,l(o.$t("search.category")),1),P(s("select",{"onUpdate:modelValue":r[4]||(r[4]=a=>t.filters.category=a),class:"form-select"},[s("option",Ne,l(o.$t("search.allCategories")),1),(d(!0),u(k,null,T(t.categories,a=>(d(),u("option",{key:a,value:a},l(a),9,We))),128))],512),[[R,t.filters.category]])]),s("div",ze,[s("label",Oe,l(o.$t("search.priceRange")),1),P(s("select",{"onUpdate:modelValue":r[5]||(r[5]=a=>t.filters.priceRange=a),class:"form-select"},[s("option",Qe,l(o.$t("search.noPriceLimit")),1),s("option",Ke,l(o.$t("search.priceRanges.range0_50")),1),s("option",je,l(o.$t("search.priceRanges.range50_100")),1),s("option",qe,l(o.$t("search.priceRanges.range100_200")),1),s("option",Ze,l(o.$t("search.priceRanges.range200_plus")),1)],512),[[R,t.filters.priceRange]])]),s("div",He,[s("label",Xe,l(o.$t("search.competition")),1),P(s("select",{"onUpdate:modelValue":r[6]||(r[6]=a=>t.filters.competition=a),class:"form-select"},[s("option",Ye,l(o.$t("common.all")),1),s("option",Ge,l(o.$t("productDetail.competition.low")),1),s("option",Je,l(o.$t("productDetail.competition.medium")),1),s("option",$e,l(o.$t("productDetail.competition.high")),1)],512),[[R,t.filters.competition]])]),s("button",{class:"btn btn-secondary",onClick:r[7]||(r[7]=(...a)=>t.clearFilters&&t.clearFilters(...a))},l(o.$t("search.clearFilters")),1)])])]),s("div",xe,[s("div",et,[s("div",tt,[s("span",ot,l(o.$t("search.resultsCount",{count:t.filteredProducts.length})),1),t.searchQuery?(d(),u("span",at,l(o.$t("search.keyword"))+': "'+l(t.searchQuery)+'" ',1)):V("",!0)]),s("div",st,[P(s("select",{"onUpdate:modelValue":r[8]||(r[8]=a=>t.sortBy=a),class:"form-select"},[s("option",rt,l(o.$t("search.sortBy.relevance")),1),s("option",lt,l(o.$t("search.sortBy.sales")),1),s("option",nt,l(o.$t("search.sortBy.price")),1),s("option",it,l(o.$t("search.sortBy.rating")),1),s("option",ct,l(o.$t("search.sortBy.competition")),1)],512),[[R,t.sortBy]]),s("button",{class:"btn btn-ghost view-toggle",onClick:r[9]||(r[9]=(...a)=>t.toggleView&&t.toggleView(...a))},l(t.viewMode==="grid"?"ðŸ“‹":"ðŸ—‚ï¸"),1)])]),t.filteredProducts.length>0?(d(),u("div",dt,[t.viewMode==="grid"?(d(),u("div",ut,[(d(!0),u(k,null,T(t.paginatedProducts,a=>(d(),de(_,{key:a.id,product:a,"is-watched":t.isWatched(a.id),"is-in-compare":t.isInCompare(a.id),onViewDetails:t.viewProductDetails,onAddToWatch:t.toggleWatch,onAddToCompare:t.addToCompare},null,8,["product","is-watched","is-in-compare","onViewDetails","onAddToWatch","onAddToCompare"]))),128))])):(d(),u("div",ht,[ue(b,{title:"",columns:t.tableColumns,data:t.paginatedTableRows,"empty-text":o.$t("search.noResults"),onRowClick:t.viewProductDetails,onSortChange:t.handleSort},{"cell-image":he(({item:a})=>[a.image?(d(),u("img",{key:0,src:a.image,alt:a.title,class:O(["table-product-image",{clickable:a.productUrl||a.url}]),onClick:z(g=>t.handleImageClick(g,a),["stop"]),onKeyup:N(z(g=>t.handleImageClick(g,a),["stop"]),["enter"]),tabindex:"0",role:"button","aria-label":`View ${a.title} on Amazon`},null,42,mt)):(d(),u("span",gt," ðŸ“¦ "))]),_:1},8,["columns","data","empty-text","onRowClick","onSortChange"])])),t.totalPages>1?(d(),u("div",pt,[s("button",{class:"btn btn-ghost",disabled:t.currentPage===1,onClick:r[10]||(r[10]=a=>t.goToPage(t.currentPage-1))},l(o.$t("common.previous")),9,ft),s("div",vt,[(d(!0),u(k,null,T(t.visiblePages,a=>(d(),u("button",{key:a,class:O(["btn",a===t.currentPage?"btn-primary":"btn-ghost"]),onClick:g=>t.goToPage(a)},l(a),11,bt))),128))]),s("button",{class:"btn btn-ghost",disabled:t.currentPage===t.totalPages,onClick:r[11]||(r[11]=a=>t.goToPage(t.currentPage+1))},l(o.$t("common.next")),9,yt)])):V("",!0)])):(d(),u("div",_t,[r[15]||(r[15]=s("div",{class:"empty-icon"},"ðŸ”",-1)),s("div",wt,l(t.loading?o.$t("search.loading")||"åŠ è½½ä¸­...":o.productStore.products.length===0?o.$t("search.noData")||"æš‚æ— äº§å“æ•°æ®":o.$t("search.noResults")),1),s("div",St,[o.productStore.products.length===0?(d(),u(k,{key:0},[Q(l(o.$t("search.noDataDesc")||'è¯·åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯ï¼Œç„¶åŽç‚¹å‡»"æœç´¢"æŒ‰é’®æ¥çˆ¬å–äº§å“æ•°æ®ã€‚'),1)],64)):(d(),u(k,{key:1},[Q(l(o.$t("search.noResultsDesc")||"å°è¯•æ›´æ”¹å…³é”®è¯æˆ–æ”¾å®½ç­›é€‰æ¡ä»¶ã€‚"),1)],64))]),s("div",Pt,[o.productStore.products.length===0?(d(),u("button",{key:0,class:"btn btn-primary",onClick:r[12]||(r[12]=(...a)=>t.loadSampleData&&t.loadSampleData(...a)),style:{"margin-right":"8px"}},l(o.$t("search.loadSampleData")||"åŠ è½½ç¤ºä¾‹æ•°æ®"),1)):V("",!0),o.productStore.products.length===0?(d(),u("button",{key:1,class:"btn btn-secondary",onClick:r[13]||(r[13]=()=>{t.searchQuery="men t-shirt",t.handleSearch()})},l(o.$t("search.tryExample")||"å°è¯•ç¤ºä¾‹æœç´¢"),1)):(d(),u("button",{key:2,class:"btn btn-primary",onClick:r[14]||(r[14]=(...a)=>t.clearFilters&&t.clearFilters(...a))},l(o.$t("search.clearAllFilters")||"æ¸…é™¤æ‰€æœ‰ç­›é€‰"),1))])]))])])}const Tt=ie(we,[["render",kt],["__scopeId","data-v-a63e9906"]]);export{Tt as default};
