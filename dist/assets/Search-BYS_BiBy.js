const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-B40vF9Ey.js","assets/index-DTWxAghn.css"])))=>i.map(i=>d[i]);
import{_ as te,r as L,c as m,o as d,a as s,t as n,j as P,v as oe,k as se,l as w,F as k,e as C,m as N,f as ae,b as re,p as ne,u as le,q as ie,g as ce,s as b,x as de,h as g,P as S,y as W,z as ue}from"./index-B40vF9Ey.js";import{P as me}from"./ProductCard-B1LQx0_a.js";import{D as he}from"./DataTable-CHOvaXra.js";const ge=o=>o==="low"?30:o==="medium"?60:100,pe=o=>{if(!o)return[null,null];if(o==="200+")return[200,null];const[r,h]=o.split("-").map(Number);return[Number.isFinite(r)?r:null,Number.isFinite(h)?h:null]},F=o=>typeof o.sales=="number"?o.sales:Math.round(o.marginRate*25+150),M=o=>{if(typeof o.rating=="number")return o.rating;const r=4.8-o.competitionScore/100*1.5;return Number(Math.max(3,Math.min(5,r)).toFixed(1))},ve={name:"Search",components:{ProductCard:me,DataTable:he},setup(){const o=le(),{t:r}=ie(),h=ce(),e=[S.AMAZON,S.SHOPEE,S.LAZADA,S.EBAY,S.ALIEXPRESS],f=b(""),u=de({platform:"",category:"",priceRange:"",competition:""}),_=b("relevance"),v=b("desc"),a=b("grid"),p=b(1),y=b(12),I=g(()=>h.loading),R=b(!1),U=g(()=>[{key:"title",label:r("search.table.name"),sortable:!0},{key:"platform",label:r("search.table.platform"),sortable:!0},{key:"formattedPrice",label:r("search.table.price"),sortable:!0},{key:"sales",label:r("search.table.sales"),sortable:!0},{key:"rating",label:r("search.table.rating"),sortable:!0},{key:"competition",label:r("search.table.competition"),sortable:!0}]),O=g(()=>{const t=Array.from(new Set(h.products.map(l=>l.platform)));return Array.from(new Set([...e,...t]))}),V=t=>{const l=`settings.platforms.${t}`,i=r(l);return i===l?t:i},Q=g(()=>{const t=new Set(h.products.map(l=>l.category));return Array.from(t)}),B=g(()=>{const[t,l]=pe(u.priceRange);return h.searchProducts(f.value,{platform:u.platform||"all",category:u.category||"all",minMargin:0,maxCompetition:ge(u.competition)}).filter(c=>!(t!==null&&c.price<t||l!==null&&c.price>l))}),T=g(()=>{const t=[...B.value],l=v.value==="asc"?1:-1;switch(_.value){case"sales":return t.sort((i,c)=>(F(i)-F(c))*l);case"price":return t.sort((i,c)=>(i.price-c.price)*l);case"rating":return t.sort((i,c)=>(M(i)-M(c))*l);case"competition":return t.sort((i,c)=>(i.competitionScore-c.competitionScore)*l);default:return t}}),D=g(()=>Math.max(1,Math.ceil(T.value.length/y.value))),z=g(()=>{const t=(p.value-1)*y.value;return T.value.slice(t,t+y.value)}),K=g(()=>T.value.map(t=>({id:t.id,title:t.title,platform:V(t.platform),formattedPrice:t.formattedPrice,sales:F(t),rating:M(t),competition:t.competitionLevel}))),q=g(()=>{const t=(p.value-1)*y.value;return K.value.slice(t,t+y.value)}),Z=g(()=>{const t=[],l=D.value,i=p.value,c=2,x=Math.max(1,i-c),ee=Math.min(l,i+c);for(let A=x;A<=ee;A+=1)t.push(A);return t}),E=async()=>{if(!(!f.value||f.value.trim()==="")){p.value=1,R.value=!0;try{(await(await ue(async()=>{const{productService:i}=await import("./index-B40vF9Ey.js").then(c=>c.K);return{productService:i}},__vite__mapDeps([0,1]))).productService.scrapeProducts(f.value.trim(),{fetchDetails:!1,maxProducts:15})).success&&await h.initialize()}catch(t){console.error("Search/Scraping failed:",t)}finally{R.value=!1}}},j=()=>{u.platform="",u.category="",u.priceRange="",u.competition="",E()},H=()=>{a.value=a.value==="grid"?"table":"grid"},X=t=>{t>=1&&t<=D.value&&(p.value=t)},Y=t=>{const l=typeof t=="string"?t:t==null?void 0:t.id;l&&o.push(`/products/${l}`)},G=t=>{try{h.toggleWatch(t)}catch(l){console.error("Failed to toggle watchlist:",l)}},J=t=>{try{h.addToCompare(t)}catch(l){console.error("Failed to add product to compare:",l)}},$=({key:t,order:l})=>{_.value=t,v.value=l==="asc"?"asc":"desc",p.value=1};return W([f,()=>u.platform,()=>u.category,()=>u.priceRange,()=>u.competition],()=>{p.value=1}),W(_,(t,l)=>{t==="relevance"?v.value="desc":(t==="price"||t==="competition")&&t!==l?v.value="asc":t!==l&&(v.value="desc")}),{t:r,loading:I,scraping:R,searchQuery:f,filters:u,sortBy:_,sortOrder:v,viewMode:a,currentPage:p,pageSize:y,tableColumns:U,platforms:O,categories:Q,filteredProducts:B,paginatedProducts:z,paginatedTableRows:q,totalPages:D,visiblePages:Z,handleSearch:E,handleScrape,clearFilters:j,toggleView:H,goToPage:X,viewProductDetails:Y,toggleWatch:G,addToCompare:J,handleSort:$,translatePlatform:V,isWatched:h.isWatched,isInCompare:h.isInCompare}}},fe={class:"search-page"},be={class:"page-header"},_e={class:"page-title"},ye={class:"page-subtitle"},Pe={class:"search-section"},we={class:"search-form"},Se={class:"search-input-group"},ke=["placeholder"],Ce=["disabled"],Re={class:"filters"},Te={class:"filter-group"},De={class:"filter-label"},Ae={value:""},Fe=["value"],Me={class:"filter-group"},Ve={class:"filter-label"},Be={value:""},Ee=["value"],Le={class:"filter-group"},Ne={class:"filter-label"},We={value:""},Ie={value:"0-50"},Ue={value:"50-100"},Oe={value:"100-200"},Qe={value:"200+"},ze={class:"filter-group"},Ke={class:"filter-label"},qe={value:""},Ze={value:"low"},je={value:"medium"},He={value:"high"},Xe={class:"results-section"},Ye={class:"results-header"},Ge={class:"results-info"},Je={class:"results-count"},$e={key:0,class:"search-term"},xe={class:"results-actions"},et={value:"relevance"},tt={value:"sales"},ot={value:"price"},st={value:"rating"},at={value:"competition"},rt={key:0,class:"results-content"},nt={key:0,class:"products-grid"},lt={key:1,class:"products-table"},it={key:2,class:"pagination"},ct=["disabled"],dt={class:"page-numbers"},ut=["onClick"],mt=["disabled"],ht={key:1,class:"empty-results"},gt={class:"empty-title"},pt={class:"empty-text"};function vt(o,r,h,e,f,u){const _=L("ProductCard"),v=L("DataTable");return d(),m("div",fe,[s("div",be,[s("h1",_e,n(o.$t("search.title")),1),s("p",ye,n(o.$t("search.subtitle")),1)]),s("div",Pe,[s("div",we,[s("div",Se,[P(s("input",{"onUpdate:modelValue":r[0]||(r[0]=a=>e.searchQuery=a),type:"text",class:"form-input search-input",placeholder:o.$t("search.placeholder"),onKeyup:r[1]||(r[1]=se((...a)=>e.handleSearch&&e.handleSearch(...a),["enter"]))},null,40,ke),[[oe,e.searchQuery]]),s("button",{class:"btn btn-primary search-btn",disabled:e.loading||e.scraping,onClick:r[2]||(r[2]=(...a)=>e.handleSearch&&e.handleSearch(...a))},n(e.loading||e.scraping?o.$t("search.searching"):o.$t("search.searchButton")),9,Ce)]),s("div",Re,[s("div",Te,[s("label",De,n(o.$t("search.platform")),1),P(s("select",{"onUpdate:modelValue":r[3]||(r[3]=a=>e.filters.platform=a),class:"form-select"},[s("option",Ae,n(o.$t("search.allPlatforms")),1),(d(!0),m(k,null,C(e.platforms,a=>(d(),m("option",{key:a,value:a},n(e.translatePlatform(a)),9,Fe))),128))],512),[[w,e.filters.platform]])]),s("div",Me,[s("label",Ve,n(o.$t("search.category")),1),P(s("select",{"onUpdate:modelValue":r[4]||(r[4]=a=>e.filters.category=a),class:"form-select"},[s("option",Be,n(o.$t("search.allCategories")),1),(d(!0),m(k,null,C(e.categories,a=>(d(),m("option",{key:a,value:a},n(a),9,Ee))),128))],512),[[w,e.filters.category]])]),s("div",Le,[s("label",Ne,n(o.$t("search.priceRange")),1),P(s("select",{"onUpdate:modelValue":r[5]||(r[5]=a=>e.filters.priceRange=a),class:"form-select"},[s("option",We,n(o.$t("search.noPriceLimit")),1),s("option",Ie,n(o.$t("search.priceRanges.range0_50")),1),s("option",Ue,n(o.$t("search.priceRanges.range50_100")),1),s("option",Oe,n(o.$t("search.priceRanges.range100_200")),1),s("option",Qe,n(o.$t("search.priceRanges.range200_plus")),1)],512),[[w,e.filters.priceRange]])]),s("div",ze,[s("label",Ke,n(o.$t("search.competition")),1),P(s("select",{"onUpdate:modelValue":r[6]||(r[6]=a=>e.filters.competition=a),class:"form-select"},[s("option",qe,n(o.$t("common.all")),1),s("option",Ze,n(o.$t("productDetail.competition.low")),1),s("option",je,n(o.$t("productDetail.competition.medium")),1),s("option",He,n(o.$t("productDetail.competition.high")),1)],512),[[w,e.filters.competition]])]),s("button",{class:"btn btn-secondary",onClick:r[7]||(r[7]=(...a)=>e.clearFilters&&e.clearFilters(...a))},n(o.$t("search.clearFilters")),1)])])]),s("div",Xe,[s("div",Ye,[s("div",Ge,[s("span",Je,n(o.$t("search.resultsCount",{count:e.filteredProducts.length})),1),e.searchQuery?(d(),m("span",$e,n(o.$t("search.keyword"))+': "'+n(e.searchQuery)+'" ',1)):N("",!0)]),s("div",xe,[P(s("select",{"onUpdate:modelValue":r[8]||(r[8]=a=>e.sortBy=a),class:"form-select"},[s("option",et,n(o.$t("search.sortBy.relevance")),1),s("option",tt,n(o.$t("search.sortBy.sales")),1),s("option",ot,n(o.$t("search.sortBy.price")),1),s("option",st,n(o.$t("search.sortBy.rating")),1),s("option",at,n(o.$t("search.sortBy.competition")),1)],512),[[w,e.sortBy]]),s("button",{class:"btn btn-ghost view-toggle",onClick:r[9]||(r[9]=(...a)=>e.toggleView&&e.toggleView(...a))},n(e.viewMode==="grid"?"ðŸ“‹":"ðŸ—‚ï¸"),1)])]),e.filteredProducts.length>0?(d(),m("div",rt,[e.viewMode==="grid"?(d(),m("div",nt,[(d(!0),m(k,null,C(e.paginatedProducts,a=>(d(),ae(_,{key:a.id,product:a,"is-watched":e.isWatched(a.id),"is-in-compare":e.isInCompare(a.id),onViewDetails:e.viewProductDetails,onAddToWatch:e.toggleWatch,onAddToCompare:e.addToCompare},null,8,["product","is-watched","is-in-compare","onViewDetails","onAddToWatch","onAddToCompare"]))),128))])):(d(),m("div",lt,[re(v,{title:"",columns:e.tableColumns,data:e.paginatedTableRows,"empty-text":o.$t("search.noResults"),onRowClick:e.viewProductDetails,onSortChange:e.handleSort},null,8,["columns","data","empty-text","onRowClick","onSortChange"])])),e.totalPages>1?(d(),m("div",it,[s("button",{class:"btn btn-ghost",disabled:e.currentPage===1,onClick:r[10]||(r[10]=a=>e.goToPage(e.currentPage-1))},n(o.$t("common.previous")),9,ct),s("div",dt,[(d(!0),m(k,null,C(e.visiblePages,a=>(d(),m("button",{key:a,class:ne(["btn",a===e.currentPage?"btn-primary":"btn-ghost"]),onClick:p=>e.goToPage(a)},n(a),11,ut))),128))]),s("button",{class:"btn btn-ghost",disabled:e.currentPage===e.totalPages,onClick:r[11]||(r[11]=a=>e.goToPage(e.currentPage+1))},n(o.$t("common.next")),9,mt)])):N("",!0)])):(d(),m("div",ht,[r[13]||(r[13]=s("div",{class:"empty-icon"}," é¦ƒæ”³ ",-1)),s("div",gt,n(o.$t("search.noResults")),1),s("div",pt,n(o.$t("search.noResultsDesc")),1),s("button",{class:"btn btn-primary",onClick:r[12]||(r[12]=(...a)=>e.clearFilters&&e.clearFilters(...a))},n(o.$t("search.clearAllFilters")),1)]))])])}const yt=te(ve,[["render",vt],["__scopeId","data-v-a2bff118"]]);export{yt as default};
